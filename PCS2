def passwordHandler(String input) {
    // ... (same as before)
}

def Update_details(instance_selected) {
    // ... (same as before)
}

pipeline {
    agent any

    environment {
        DEV_Creds = credentials('DEV_CredID')
    }

    parameters {
        booleanParam(name: 'Deactivate_Application', defaultValue: false, description: 'Check the box to deactivate the application')
        string(name: 'Application_ID', defaultValue: '', description: 'Application ID', trim: true, visible: false)
        string(name: 'Deactivate_Application_Version', defaultValue: '', description: 'Deactivation Application Version', trim: true, visible: false)
    }

    stages {
        stage('Import Process Application') {
            steps {
                // ... (same as before)
            }
        }

        stage('Deactivate Previous Application') {
            steps {
                script {
                    if (params.Deactivate_Application) {
                        echo 'Checkbox is checked'
                        Update_details((params.InstanceURL).toString())
                        withCredentials([usernamePassword(credentialsId: 'DEV_CredID', passwordVariable: 'PSW', usernameVariable: 'USR')]) {
                            // Prompt for Application_ID and Deactivate_Application_Version only if the checkbox is checked
                            def userInput = input message: 'Enter Application ID and Deactivation Application Version:', parameters: [
                                [$class: 'TextParameterDefinition', name: 'Application_ID', defaultValue: '', description: 'Application ID'],
                                [$class: 'TextParameterDefinition', name: 'Deactivate_Application_Version', defaultValue: '', description: 'Deactivation Application Version']
                            ]
                            def applicationID = userInput['Application_ID']
                            def deactivationVersion = userInput['Deactivate_Application_Version']

                            def deployIntegCmd = "curl -X PATCH \"${env.serviceURL}/ic/api/process/v1/targets/ORACLEINTERNALPCS/projects/${applicationID}/revisions/${deactivationVersion}\" --user \"${USR}:${passwordHandler(PSW)}\" --header \"Content-Type: application/json\" --data \"{\\\"state\\\": \\\"OFF\\\", \\\"mode\\\": \\\"RETIRED\\\"}\""
                            bat(deployIntegCmd)
                            echo "Application deactivated"
                        }
                    } else {
                        echo 'Checkbox is unchecked'
                    }
                }
            }
        }
    }
}
